
ubuntu@sandbox-node2:~$ sudo kubectl get pvc -n awx
NAME                            STATUS    VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
awx-projects-claim              Pending                                                                        local-path     <unset>                 2d2h
postgres-15-awx-postgres-15-0   Bound     pvc-4d925fab-2fb3-4e3f-b199-196f4374881d   8Gi        RWO            local-path     <unset>                 2d2h

ubuntu@sandbox-node2:~$ sudo kubectl get storageclass
NAME                   PROVISIONER             RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE
local-path (default)   rancher.io/local-path   Delete          WaitForFirstConsumer   false                  2d19h
ubuntu@sandbox-node2:~$

ubuntu@sandbox-node2:~$ sudo kubectl patch storageclass local-path -p '{"volumeBindingMode":"Immediate"}'
The StorageClass "local-path" is invalid: volumeBindingMode: Invalid value: "Immediate": field is immutable

ubuntu@sandbox-node2:~$ sudo kubectl get storageclass local-path -o yaml | grep volumeBindingMode
volumeBindingMode: WaitForFirstConsumer
ubuntu@sandbox-node2:~$

cat <<EOF | kubectl apply -f -
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: local-path-immediate
provisioner: rancher.io/local-path
reclaimPolicy: Delete
volumeBindingMode: Immediate
EOF

ubuntu@sandbox-node2:~$ sudo kubectl get pvc -n awx
NAME                            STATUS    VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS           VOLUMEATTRIBUTESCLASS   AGE
awx-projects-claim              Pending                                                                        local-path-immediate   <unset>                 5m45s
postgres-15-awx-postgres-15-0   Bound     pvc-4d925fab-2fb3-4e3f-b199-196f4374881d   8Gi        RWO            local-path             <unset>                 2d2h
ubuntu@sandbox-node2:~$ sudo kubectl get pods -n awx
NAME                                               READY   STATUS    RESTARTS   AGE
awx-operator-controller-manager-58b7c97f4b-mncsk   2/2     Running   0          64s
awx-postgres-15-0                                  1/1     Running   0          62s
awx-task-55f5964cb4-f8sqh                          0/4     Pending   0          63s
awx-task-6b9698bbdd-gtdsx                          0/4     Pending   0          63s
awx-web-585dd589c5-htl9d                           0/3     Pending   0          63s
awx-web-6cc598b7-ll77h                             0/3     Pending   0          63s
ubuntu@sandbox-node2:~$

ubuntu@sandbox-node2:~$ sudo kubectl logs -n kube-system deployment/local-path-provisioner
I1224 16:52:48.114961       1 event.go:389] "Event occurred" object="awx/awx-projects-claim" fieldPath="" kind="PersistentVolumeClaim" apiVersion="v1" type="Warning" reason="ProvisioningFailed" message="failed to provision volume with StorageClass \"local-path-immediate\": NodePath only supports ReadWriteOnce and ReadWriteOncePod (1.22+) access modes"
I1224 16:53:16.140588       1 controller.go:968] "Retrying syncing claim because failures < threshold" key="10a1dffc-87d3-41d4-8cf7-53fb3bb4cd8f" failures=5 threshold=15
E1224 16:53:16.140695       1 controller.go:988] "Unhandled Error" err="error syncing claim \"10a1dffc-87d3-41d4-8cf7-53fb3bb4cd8f\": failed to provision volume with StorageClass \"local-path-immediate\": NodePath only supports ReadWriteOnce and ReadWriteOncePod (1.22+) access modes" logger="UnhandledError"
I1224 16:53:16.140942       1 event.go:389] "Event occurred" object="awx/awx-projects-claim" fieldPath="" kind="PersistentVolumeClaim" apiVersion="v1" type="Normal" reason="Provisioning" message="External provisioner is provisioning volume for claim \"awx/awx-projects-claim\""
I1224 16:53:16.141125       1 event.go:389] "Event occurred" object="awx/awx-projects-claim" fieldPath="" kind="PersistentVolumeClaim" apiVersion="v1" type="Warning" reason="ProvisioningFailed" message="failed to provision volume with StorageClass \"local-path-immediate\": NodePath only supports ReadWriteOnce and ReadWriteOncePod (1.22+) access modes"

ubuntu@sandbox-node2:~$ sudo kubectl get pvc -n awx
NAME                            STATUS    VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS           VOLUMEATTRIBUTESCLASS   AGE
awx-projects-claim              Pending                                                                        local-path-immediate   <unset>                 5m3s
postgres-15-awx-postgres-15-0   Bound     pvc-4d925fab-2fb3-4e3f-b199-196f4374881d   8Gi        RWO            local-path             <unset>                 2d3h
ubuntu@sandbox-node2:~$ sudo kubectl get pod -n awx
NAME                                               READY   STATUS    RESTARTS   AGE
awx-operator-controller-manager-58b7c97f4b-jhmvs   2/2     Running   0          6m48s
awx-postgres-15-0                                  1/1     Running   0          6m47s
awx-task-56c5b5fdb6-gw442                          0/4     Pending   0          5m1s
awx-task-6b9698bbdd-74jfv                          0/4     Pending   0          6m48s
awx-web-6cc598b7-dh9f6                             0/3     Pending   0          6m48s
awx-web-7b7d8f9d4f-tpglf                           0/3     Pending   0          5m5s
ubuntu@sandbox-node2:~$
ubuntu@sandbox-node2:~$ sudo kubectl logs -n kube-system deployment/local-path-provisioner
I1224 17:07:48.115185       1 event.go:389] "Event occurred" object="awx/awx-projects-claim" fieldPath="" kind="PersistentVolumeClaim" apiVersion="v1" type="Normal" reason="Provisioning" message="External provisioner is provisioning volume for claim \"awx/awx-projects-claim\""
I1224 17:07:48.115213       1 event.go:389] "Event occurred" object="awx/awx-projects-claim" fieldPath="" kind="PersistentVolumeClaim" apiVersion="v1" type="Warning" reason="ProvisioningFailed" message="failed to provision volume with StorageClass \"local-path-immediate\": configuration error, no node was specified"
I1224 17:08:21.518242       1 controller.go:968] "Retrying syncing claim because failures < threshold" key="dc91c20f-f832-4124-8316-9080de6d3671" failures=4 threshold=15
E1224 17:08:21.518373       1 controller.go:988] "Unhandled Error" err="error syncing claim \"dc91c20f-f832-4124-8316-9080de6d3671\": failed to provision volume with StorageClass \"local-path-immediate\": configuration error, no node was specified" logger="UnhandledError"
I1224 17:08:21.518496       1 event.go:389] "Event occurred" object="awx/awx-projects-claim" fieldPath="" kind="PersistentVolumeClaim" apiVersion="v1" type="Normal" reason="Provisioning" message="External provisioner is provisioning volume for claim \"awx/awx-projects-claim\""
I1224 17:08:21.518615       1 event.go:389] "Event occurred" object="awx/awx-projects-claim" fieldPath="" kind="PersistentVolumeClaim" apiVersion="v1" type="Warning" reason="ProvisioningFailed" message="failed to provision volume with StorageClass \"local-path-immediate\": configuration error, no node was specified"

ubuntu@sandbox-node2:~$ sudo kubectl get pod -n awx
NAME                                               READY   STATUS      RESTARTS   AGE
awx-migration-24.6.1-bwj64                         0/1     Completed   0          15m
awx-operator-controller-manager-58b7c97f4b-hh9mr   2/2     Running     0          17m
awx-postgres-15-0                                  1/1     Running     0          17m
awx-task-5b87f9d6d5-pw8cn                          4/4     Running     0          15m
awx-web-7bdfbc5dfb-6txrl                           3/3     Running     0          17m
ubuntu@sandbox-node2:~$ sudo kubectl get svc -n awx
NAME                                              TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
awx-operator-controller-manager-metrics-service   ClusterIP   10.43.27.26     <none>        8443/TCP       3d
awx-postgres-15                                   ClusterIP   None            <none>        5432/TCP       3d
awx-service                                       NodePort    10.43.111.116   <none>        80:30080/TCP   3d
ubuntu@sandbox-node2:~$

ubuntu@sandbox-node2:~$ sudo kubectl describe certificate -n awx
Name:         awx-tls
Namespace:    awx
Labels:       <none>
Annotations:  <none>
API Version:  cert-manager.io/v1
Kind:         Certificate
Metadata:
  Creation Timestamp:  2025-12-25T15:33:35Z
  Generation:          1
  Owner References:
    API Version:           networking.k8s.io/v1
    Block Owner Deletion:  true
    Controller:            true
    Kind:                  Ingress
    Name:                  awx-ingress
    UID:                   c782c219-2f2e-4d21-9c84-9048750fddaf
  Resource Version:        309236
  UID:                     2bd2c3f5-ce20-49a6-9813-8328564cb6fd
Spec:
  Dns Names:
    sandbox-node2.ddc.local
  Issuer Ref:
    Group:      cert-manager.io
    Kind:       ClusterIssuer
    Name:       letsencrypt-prod
  Secret Name:  awx-tls
  Usages:
    digital signature
    key encipherment
Status:
  Conditions:
    Last Transition Time:    2025-12-25T15:33:35Z
    Message:                 Issuing certificate as Secret does not exist
    Observed Generation:     1
    Reason:                  DoesNotExist
    Status:                  False
    Type:                    Ready
    Last Transition Time:    2025-12-25T15:33:36Z
    Message:                 The certificate request has failed to complete and will be retried: Failed to wait for order resource "awx-tls-1-2322550606" to become ready: order is in "errored" state: Failed to create Order: 400 urn:ietf:params:acme:error:rejectedIdentifier: Invalid identifiers requested :: Cannot issue for "sandbox-node2.ddc.local": Domain name does not end with a valid public suffix (TLD)
    Observed Generation:     1
    Reason:                  Failed
    Status:                  False
    Type:                    Issuing
  Failed Issuance Attempts:  1
  Last Failure Time:         2025-12-25T15:33:36Z
Events:
  Type     Reason     Age    From                                       Message
  ----     ------     ----   ----                                       -------
  Normal   Issuing    7m53s  cert-manager-certificates-trigger          Issuing certificate as Secret does not exist
  Normal   Generated  7m53s  cert-manager-certificates-key-manager      Stored new private key in temporary Secret resource "awx-tls-55vdr"
  Normal   Requested  7m53s  cert-manager-certificates-request-manager  Created new CertificateRequest resource "awx-tls-1"
  Warning  Failed     7m52s  cert-manager-certificates-issuing          The certificate request has failed to complete and will be retried: Failed to wait for order resource "awx-tls-1-2322550606" to become ready: order is in "errored" state: Failed to create Order: 400 urn:ietf:params:acme:error:rejectedIdentifier: Invalid identifiers requested :: Cannot issue for "sandbox-node2.ddc.local": Domain name does not end with a valid public suffix (TLD)
ubuntu@sandbox-node2:~$
ubuntu@sandbox-node2:~$ sudo kubectl describe ingress awx-ingress -n awx
Name:             awx-ingress
Labels:           <none>
Namespace:        awx
Address:
Ingress Class:    nginx
Default backend:  <default>
TLS:
  awx-tls terminates sandbox-node2.ddc.local
Rules:
  Host                     Path  Backends
  ----                     ----  --------
  sandbox-node2.ddc.local
                           /   awx-service:80 (10.42.0.50:8052)
Annotations:               cert-manager.io/cluster-issuer: letsencrypt-prod
                           nginx.ingress.kubernetes.io/backend-protocol: HTTP
                           nginx.ingress.kubernetes.io/proxy-body-size: 50m
                           nginx.ingress.kubernetes.io/ssl-redirect: true
Events:
  Type    Reason             Age                 From                       Message
  ----    ------             ----                ----                       -------
  Normal  Sync               8m7s (x2 over 22m)  nginx-ingress-controller   Scheduled for sync
  Normal  CreateCertificate  8m7s                cert-manager-ingress-shim  Successfully created Certificate "awx-tls"
ubuntu@sandbox-node2:~$


ubuntu@sandbox-node2:~$ sudo kubectl get pod -n awx
NAME                                               READY   STATUS      RESTARTS   AGE
awx-migration-24.6.1-bwj64                         0/1     Completed   0          18h
awx-operator-controller-manager-58b7c97f4b-hh9mr   2/2     Running     0          18h
awx-postgres-15-0                                  1/1     Running     0          18h
awx-task-5b87f9d6d5-pw8cn                          4/4     Running     0          18h
awx-web-85887d45cd-c2mw7                           3/3     Running     0          14m
ubuntu@sandbox-node2:~$
ubuntu@sandbox-node2:~$
ubuntu@sandbox-node2:~$ sudo kubectl get svc -n awx
NAME                                              TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
awx-operator-controller-manager-metrics-service   ClusterIP   10.43.27.26     <none>        8443/TCP   3d18h
awx-postgres-15                                   ClusterIP   None            <none>        5432/TCP   3d18h
awx-service                                       ClusterIP   10.43.111.116   <none>        80/TCP     3d18h
ubuntu@sandbox-node2:~$
ubuntu@sandbox-node2:~$

ubuntu@sandbox-node2:~$ sudo kubectl get svc -n ingress-nginx
NAME                                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                      AGE
ingress-nginx-controller             NodePort    10.43.46.22    <none>        80:31035/TCP,443:31990/TCP   3d17h
ingress-nginx-controller-admission   ClusterIP   10.43.50.154   <none>        443/TCP                      3d17h
ubuntu@sandbox-node2:~$
ubuntu@sandbox-node2:~$ sudo kubectl describe ingress awx-ingress -n awx
Name:             awx-ingress
Labels:           <none>
Namespace:        awx
Address:          10.43.46.22
Ingress Class:    nginx
Default backend:  <default>
TLS:
  awx-tls terminates sandbox-node2.ddc.local
Rules:
  Host                     Path  Backends
  ----                     ----  --------
  sandbox-node2.ddc.local
                           /   awx-service:80 (10.42.0.51:8052)
Annotations:               cert-manager.io/cluster-issuer: letsencrypt-prod
                           nginx.ingress-kubernetes.io/ssl-redirect: false
                           nginx.ingress.kubernetes.io/backend-protocol: HTTP
                           nginx.ingress.kubernetes.io/proxy-body-size: 50m
                           nginx.ingress.kubernetes.io/ssl-redirect: false
Events:
  Type    Reason             Age                  From                       Message
  ----    ------             ----                 ----                       -------
  Normal  CreateCertificate  29m                  cert-manager-ingress-shim  Successfully created Certificate "awx-tls"
  Normal  Sync               2m30s (x5 over 43m)  nginx-ingress-controller   Scheduled for sync
ubuntu@sandbox-node2:~$

ubuntu@sandbox-node2:~$ sudo kubectl rollout restart deployment ingress-nginx-controller -n ingress-nginx
deployment.apps/ingress-nginx-controller restarted
ubuntu@sandbox-node2:~$
ubuntu@sandbox-node2:~$ sudo kubectl get svc -n ingress-nginx
NAME                                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE
ingress-nginx-controller             ClusterIP   10.43.46.22    <none>        80/TCP,443/TCP   3d17h
ingress-nginx-controller-admission   ClusterIP   10.43.50.154   <none>        443/TCP          3d17h
ubuntu@sandbox-node2:~$
ubuntu@sandbox-node2:~$
ubuntu@sandbox-node2:~$ sudo kubectl get pod -n awx
NAME                                               READY   STATUS      RESTARTS   AGE
awx-migration-24.6.1-bwj64                         0/1     Completed   0          18h
awx-operator-controller-manager-58b7c97f4b-hh9mr   2/2     Running     0          18h
awx-postgres-15-0                                  1/1     Running     0          18h
awx-task-5b87f9d6d5-pw8cn                          4/4     Running     0          18h
awx-web-5788b7675f-tt8kk                           3/3     Running     0          25m
ubuntu@sandbox-node2:~$ sudo kubectl get svc -n awx
NAME                                              TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
awx-operator-controller-manager-metrics-service   ClusterIP   10.43.27.26     <none>        8443/TCP   3d19h
awx-postgres-15                                   ClusterIP   None            <none>        5432/TCP   3d18h
awx-service                                       ClusterIP   10.43.111.116   <none>        80/TCP     3d18h
ubuntu@sandbox-node2:~$

ubuntu@sandbox-node2:~$ sudo netstat -lntp | grep -E ':80|:443'
ubuntu@sandbox-node2:~$ sudo netstat -lntp | grep -i listen
tcp        0      0 127.0.0.1:10010         0.0.0.0:*               LISTEN      1559/containerd
tcp        0      0 127.0.0.1:10248         0.0.0.0:*               LISTEN      1256/k3s server
tcp        0      0 127.0.0.1:10249         0.0.0.0:*               LISTEN      1256/k3s server
tcp        0      0 127.0.0.1:10256         0.0.0.0:*               LISTEN      1256/k3s server
tcp        0      0 127.0.0.1:10257         0.0.0.0:*               LISTEN      1256/k3s server
tcp        0      0 127.0.0.1:10258         0.0.0.0:*               LISTEN      1256/k3s server
tcp        0      0 127.0.0.1:10259         0.0.0.0:*               LISTEN      1256/k3s server
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1265/sshd: /usr/sbi
tcp        0      0 127.0.0.1:6444          0.0.0.0:*               LISTEN      1256/k3s server
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      1156/systemd-resolv
tcp6       0      0 :::10250                :::*                    LISTEN      1256/k3s server
tcp6       0      0 :::22                   :::*                    LISTEN      1265/sshd: /usr/sbi
tcp6       0      0 :::6443                 :::*                    LISTEN      1256/k3s server
ubuntu@sandbox-node2:~$
